<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Instagram Unfollower Checker v3</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="static/style.css">
<style>
  :root {
    --ig-pink: #E1306C;
    --ig-purple: #833AB4;
    --ig-blue: #405DE6;
}

body {
    background: #fafafa;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
}

.ig-header {
    background: linear-gradient(45deg, var(--ig-blue), var(--ig-purple), var(--ig-pink));
    color: white;
    padding: 4rem 0;
    text-align: center;
    margin-bottom: 3rem;
}

.upload-card {
    background: white;
    border-radius: 1rem;
    padding: 2rem;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}

.file-upload {
    margin: 1.5rem 0;
    border: 2px dashed #ddd;
    padding: 2rem;
    border-radius: 0.5rem;
    transition: all 0.3s ease;
}

.file-upload:hover {
    border-color: var(--ig-pink);
    background: rgba(225, 48, 108, 0.05);
}

.btn-analyze {
    background: var(--ig-pink);
    color: white;
    padding: 1rem 2rem;
    border: none;
    border-radius: 0.5rem;
    width: 100%;
    font-size: 1.1rem;
    transition: transform 0.2s ease;
}

.btn-analyze:hover {
    transform: translateY(-2px);
    background: #C9225B;
}

.user-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem;
    border-bottom: 1px solid #eee;
}

.username {
    color: var(--ig-pink);
    text-decoration: none;
    font-weight: 500;
}

.username:hover {
    color: var(--ig-purple);
}

.loading-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(255,255,255,0.9);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 1000;
}
 /* Add updated file input validation style */
 input[type="file"] {
            display: none;
        }
        .custom-file-upload {
            border: 2px solid #E1306C;
            padding: 6px 12px;
            cursor: pointer;
            border-radius: 5px;
            margin-top: 10px;
        }
/* Add updated styles */
.developer-section {
            background: linear-gradient(145deg, #ffffff, #f8f9fa);
            padding: 2rem;
            border-radius: 1rem;
            margin-top: 3rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border: 1px solid #eee;
        }

        .guide-toggle {
            color: var(--ig-pink);
            cursor: pointer;
            margin: 1rem 0;
        }

        .data-guide {
            background: white;
            padding: 1.5rem;
            border-radius: 0.5rem;
            margin: 1rem 0;
            display: none;
        }

        .footer {
            margin-top: 3rem;
            padding: 2rem 0;
            text-align: center;
            background: #fff;
        }

        .badge-version {
            font-size: 0.8em;
            vertical-align: super;
        }

        /* Update button styles */
        .btn-download-pdf {
            background: var(--ig-purple);
            color: white;
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: 0.5rem;
            margin-top: 1rem;
            transition: transform 0.2s ease;
        }
/* Complete CSS available in GitHub repo */
</style>
  </head>
<body>
    <div class="loading-overlay" id="loading">
        <div class="loader-content">
            <div class="spinner"></div>
            <p>Analyzing your Instagram connections...</p>
        </div>
    </div>

    <header class="ig-header">
        <div class="container">
            <h1>
                <i class="fab fa-instagram"></i>
                Instagram Unfollower Checker
                <span class="badge bg-light text-dark">v3.1.2 </span>
            </h1>
            <p class="lead">Discover who isn't following you back</p>
        </div>
    </header>

    <main class="container main-content">
        <div class="upload-card">
            <h2><i class="fas fa-cloud-upload-alt"></i> Upload Your Data</h2>
            <form id="uploadForm" enctype="multipart/form-data">
                <div class="file-upload">
                    <label for="following">
                        <i class="fas fa-user-plus"></i>
                        Following Data (JSON/HTML)
                        <br>
                        <span class="custom-file-upload">
                            Choose File
                        </span>
                        <span id="followingFileName"></span>
                    </label>
                    <input type="file" id="following" name="following" 
                           accept=".json,.html" required>
                </div>
                
                <div class="file-upload">
                    <label for="followers">
                        <i class="fas fa-users"></i>
                        Followers Data (JSON/HTML)
                        <br>
                        <span class="custom-file-upload">
                            Choose File
                        </span>
                        <span id="followersFileName"></span>
                    </label>
                    <input type="file" id="followers" name="followers" 
                           accept=".json,.html" required>
                </div>

                <button type="submit" class="btn-analyze">
                    <i class="fas fa-search"></i>
                    Analyze Connections
                </button>
            </form>
        </div>

        <div id="results" class="results-container"></div>
    </main>

    <footer class="footer">
        <div class="container">
            <div class="developer-section">
                <h4>Developed with ‚ù§Ô∏è by Prabin Bhandari</h4>
                <div class="guide-toggle" onclick="toggleGuide()">
                    <i class="fas fa-question-circle"></i> How to get Instagram data? Clicküëà
                </div>
                <div class="data-guide" id="dataGuide">
                    <ol class="text-start">
                        <li>Go to your Instagram profile</li>
                        <li>Navigate to Settings ‚Üí <b>Your Information & permissions</b>‚Üí <b> Your Information</b></li>
                        <li>Tap on "<b>Download or transfer information</b>" choose your Instagram profile, and press "Next."</li>
                        <li> Now, select "<b>Some of your information</b>". Scroll to "<b>Connections</b>" section</li>
                        <li>Choose only "<b>Followers and Following </b>" and press "Next. with any format HTML/JSON</li>
                        <li>Upload the received files here</li>
                    </ol>
                </div>
                <a href="https://github.com/prabinbessie/instagram-unfollower-checker" 
                   target="_blank" 
                   class="btn btn-outline-dark mt-2">
                    <i class="fab fa-github"></i> View on GitHub
                </a>
            </div>
            <div class="disclaimer mt-3">
                <small class="text-muted">Not affiliated with Instagram. We don't store your data.</small>
            </div>
        </div>
    </footer>

    <script>
     document.getElementById('uploadForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            const loading = document.getElementById('loading');
            
            try {
                loading.style.display = 'flex';
                
                const analysis = await fetch('/analyze/json', {
                    method: 'POST',
                    body: formData
                });
                
                if (!analysis.ok) throw await analysis.json();
                const {count, results} = await analysis.json();

                const resultsContainer = document.getElementById('results');
                resultsContainer.innerHTML = results.length ? `
                     <div class="results-card">
        <h3><i class="fas fa-users-slash"></i> ${count} Non-Followers Found</h3>
        <button class="btn-download-pdf mb-4" onclick="generatePDF(event)">
            <i class="fas fa-file-pdf"></i> Download PDF Report
        </button>
        <div class="user-list">
            ${results.map(user => `
                <div class="user-item">
                    <a href="${user.profile_url}" target="_blank" class="username">
                        @${user.username}
                    </a>
                    <span class="badge">#${user.id}</span>
                </div>
            `).join('')}
        </div>
    </div>
` : `<div class="alert-success">All follows are mutual! üéâ</div>`;

            } catch (error) {
                showError(error.message || 'An error occurred');
            } finally {
                loading.style.display = 'none';
                e.target.reset(); 
            }
        });
       
        async function generatePDF(e) {
        try {
            const formData = new FormData(document.getElementById('uploadForm'));
            const loading = document.getElementById('loading');
            
            // Get fresh data for PDF
            loading.style.display = 'flex';
            const analysis = await fetch('/analyze/pdf', {
                method: 'POST',
                body: formData
            });
            
            if (!analysis.ok) throw await analysis.json();
            
            const pdfBlob = await analysis.blob();
            const pdfUrl = URL.createObjectURL(pdfBlob);
            const link = document.createElement('a');
            link.href = pdfUrl;
            link.download = `instagram_non_followers_${Date.now()}.pdf`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        } catch (error) {
            showError(error.message || 'PDF generation failed');
        } finally {
            loading.style.display = 'none';
        }
    }
        function toggleGuide() {
            const guide = document.getElementById('dataGuide');
            guide.style.display = guide.style.display === 'none' ? 'block' : 'none';
        }
        // Add file name display
    document.getElementById('following').addEventListener('change', function(e) {
        document.getElementById('followingFileName').textContent = e.target.files[0].name;
    });
    
    document.getElementById('followers').addEventListener('change', function(e) {
        document.getElementById('followersFileName').textContent = e.target.files[0].name;
    });
    function showError(message) {
        const alert = document.createElement('div');
        alert.className = 'alert-error';
        alert.innerHTML = `
            <i class="fas fa-exclamation-triangle"></i>
            ${message}
        `;
        document.getElementById('results').prepend(alert);
        setTimeout(() => alert.remove(), 5000);
    }
    </script>
</body>
</html>